<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>DedemTV</title>
    <style>
        body, html { margin: 0; padding: 0; overflow: hidden; width: 100%; height: 100%; background-color: #000; color: white; font-family: sans-serif;}
        .fullscreen-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        #player, #message-container { display: none; }
        #player iframe { width: 100%; height: 100%; border: none; }
        #message-container { display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; font-size: 5vw; padding: 20px; box-sizing: border-box; }
        .swipe-area { position: absolute; top: 0; width: 50%; height: 100%; z-index: 10; }
        #swipe-left { left: 0; } #swipe-right { right: 0; }
        #interaction-layer { background-color: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; font-size: 5vw; z-index: 100; }
    </style>
</head>
<body>
    <div id="interaction-layer" class="fullscreen-container" onclick="startPlayback()">Oynatmak için<br>Ekrana Dokunun</div>
    <div id="player" class="fullscreen-container"></div>
    <div id="message-container" class="fullscreen-container">
        <h1 id="message-text"></h1>
        <audio id="message-audio" controls></audio>
    </div>
    <div class="swipe-area" id="swipe-left" onclick="prevItem()"></div>
    <div class="swipe-area" id="swipe-right" onclick="nextItem()"></div>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        let player, playlist, currentItemIndex = 0;
        let isReady = false;

        function startPlayback() {
            document.getElementById('interaction-layer').style.display = 'none';
            fetch('config.json')
                .then(response => response.json())
                .then(data => {
                    playlist = data.items;
                    if (playlist && playlist.length > 0) {
                        loadItem(currentItemIndex);
                    }
                })
                .catch(error => console.error('Yapılandırma dosyası yüklenemedi:', error));
        }

        function loadItem(index) {
            const item = playlist[index];
            hideAllContainers();
            if (item.type === 'youtube') {
                document.getElementById('player').style.display = 'block';
                if (!player) {
                    player = new YT.Player('player', {
                        height: '100%', width: '100%', videoId: item.videoId,
                        playerVars: { 'autoplay': 1, 'controls': 0, 'rel': 0 },
                        events: { 'onReady': () => isReady = true, 'onStateChange': onPlayerStateChange }
                    });
                } else {
                    player.loadVideoById(item.videoId);
                }
            } else if (item.type === 'message') {
                document.getElementById('message-container').style.display = 'flex';
                document.getElementById('message-text').innerText = item.text;
                const audioPlayer = document.getElementById('message-audio');
                if(item.audioUrl) {
                    audioPlayer.src = item.audioUrl;
                    audioPlayer.play();
                    audioPlayer.style.display = 'block';
                } else {
                    audioPlayer.style.display = 'none';
                }
            }
        }

        function onPlayerStateChange(event) { if (event.data === YT.PlayerState.ENDED) nextItem(); }
        function hideAllContainers() {
            if(player && typeof player.stopVideo === 'function') player.stopVideo();
            document.getElementById('player').style.display = 'none';
            document.getElementById('message-container').style.display = 'none';
        }
        function nextItem() { currentItemIndex = (currentItemIndex + 1) % playlist.length; loadItem(currentItemIndex); }
        function prevItem() { currentItemIndex = (currentItemIndex - 1 + playlist.length) % playlist.length; loadItem(currentItemIndex); }
    </script>
</body>
</html>
