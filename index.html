<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>DedemTV</title>
    <style>
        body, html { margin: 0; padding: 0; overflow: hidden; width: 100%; height: 100%; background-color: #000; color: white; font-family: sans-serif; }
        .channel-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; z-index: 1; transition: opacity 0.3s; pointer-events: none; }
        .channel-container.active { opacity: 1; z-index: 2; pointer-events: auto; }
        .channel-container#container-clock { display: flex; flex-direction: column; justify-content: center; align-items: center; }
        #clock-time { font-size: 15vw; }
        #clock-date { font-size: 5vw; }
        .channel-container video, .channel-container iframe { width: 100%; height: 100%; border: none; background-color: #000; }
        #channel-title { position: absolute; top: 10px; left: 10px; background-color: rgba(0,0,0,0.6); padding: 10px; font-size: 2vw; border-radius: 5px; z-index: 50; }
        .swipe-area { position: absolute; top: 0; width: 50%; height: 100%; z-index: 100; }
        #swipe-left { left: 0; } #swipe-right { right: 0; }
    </style>
</head>
<body>
    <div id="channel-title"></div>
    <div id="main-container"></div>
    <div class="swipe-area" id="swipe-left" onclick="changeChannel(-1)"></div>
    <div class="swipe-area" id="swipe-right" onclick="changeChannel(1)"></div>

    <script>
        let channels, currentChannelIndex = 0;
        let clockInterval;

        const mainContainer = document.getElementById('main-container');
        const titleElement = document.getElementById('channel-title');

        fetch('config.json')
            .then(response => response.json())
            .then(data => {
                channels = data.channels;
                buildChannels();
                showChannel(0);
            })
            .catch(error => titleElement.innerText = 'Yapılandırma yüklenemedi.');
            
        function buildChannels() {
            channels.forEach((channel, index) => {
                const container = document.createElement('div');
                container.id = `channel-${index}`;
                container.classList.add('channel-container');

                if (channel.type === 'clock') {
                    container.id = 'container-clock';
                    container.innerHTML = `<div id="clock-time"></div><div id="clock-date"></div>`;
                } else if (channel.type === 'video') {
                    container.innerHTML = `<video src="${channel.url}" controls loop></video>`;
                } else if (channel.type === 'web_content') {
                    container.innerHTML = `<iframe src="${channel.url}" sandbox="allow-scripts allow-same-origin allow-presentation"></iframe>`;
                }
                mainContainer.appendChild(container);
            });
        }
        
        function showChannel(index) {
            // Önceki kanalı duraklat
            const prevChannelIndex = (index - 1 + channels.length) % channels.length;
            const prevContainer = document.getElementById(`channel-${prevChannelIndex}`);
            const prevVideo = prevContainer ? prevContainer.querySelector('video') : null;
            if (prevVideo) prevVideo.pause();

            document.querySelectorAll('.channel-container').forEach((el, i) => {
                const video = el.querySelector('video');
                if (i === index) {
                    el.classList.add('active');
                    titleElement.innerText = channels[i].title;
                    if (channels[i].type === 'clock') {
                        updateClock();
                        clockInterval = setInterval(updateClock, 1000);
                    } else if (video) {
                        video.play();
                    }
                } else {
                    el.classList.remove('active');
                    clearInterval(clockInterval);
                    // Videoları duraklatmak daha iyi performans sağlar
                    if (video && i !== (index + 1 + channels.length) % channels.length) { // bir sonraki ve önceki dışındakileri duraklat
                         if (video) video.pause();
                    }
                }
            });
        }

        function changeChannel(direction) {
            currentChannelIndex = (currentChannelIndex + direction + channels.length) % channels.length;
            showChannel(currentChannelIndex);
        }
        
        function updateClock() {
            const now = new Date();
            const timeEl = document.getElementById('clock-time');
            const dateEl = document.getElementById('clock-date');
            if(timeEl) timeEl.innerText = now.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
            if(dateEl) dateEl.innerText = now.toLocaleDateString('tr-TR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        }
    </script>
</body>
</html>
